<!DOCTYPE html>
<html>
    <head>
        <title>{% block title %}Welcome!{% endblock %}</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        
        <link href="{{ asset('bundles/facgeneral/css/style.css') }}" rel="stylesheet">
        <link href="{{ asset('bundles/facgeneral/css/bootstrap.min.css') }}" rel="stylesheet">
        <link href="{{ asset('bundles/facgeneral/css/sb-admin.css') }}" rel="stylesheet">
        <link href="{{ asset('bundles/facgeneral/css/jquery-ui.min.css') }}" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{{ asset('bundles/facgeneral/js/jquery.fancybox.css') }}" media="screen" />
       <!-- <link href="/css/video-js.min.css" rel="stylesheet" type="text/css"> -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        {% block stylesheets %}{% endblock %}
        <script src="{{ asset('bundles/facgeneral/js/jquery-1.11.1.min.js') }}" type="text/javascript"></script>
        <script src="{{ asset('bundles/facgeneral/js/jquery-ui.min.js') }}" type="text/javascript"></script>
        <script src="{{ asset('bundles/facgeneral/js/bootstrap.min.js') }}" type="text/javascript"></script>
        <script type="text/javascript" src="{{ asset('bundles/facgeneral/js/noty/packaged/jquery.noty.packaged.min.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/facgeneral/js/noty/themes/bootstrap.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/facgeneral/js/history.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/facgeneral/js/history.html4.js') }}"></script>
 		<script type="text/javascript" src="{{ asset('bundles/facgeneral/js/jquery.fancybox.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/facgeneral/js/history.adapter.jquery.js') }}"></script>
        
        <script>
            function generate(type, text) {
                var n = noty({
                    text        : text,
                    type        : type,
                    dismissQueue: true,
                    layout      : 'topCenter',
                    theme       : 'bootstrapTheme',
                    closeWith   : ['button', 'click'],
                    maxVisible  : 20,
                    modal       : false,
                    timeout: 10000
                });
                //console.log('html: ' + n.options.id);
            }
            /*
            generate('alert', 'bootstrapTheme');
            generate('information', 'bootstrapTheme');
            generate('error', 'bootstrapTheme');
            generate('warning', 'bootstrapTheme');
            generate('success', 'bootstrapTheme');
            */
        </script>
        {% block javascripts %}{% endblock %}
        <style>
            {% if menuShow is not defined or menuShow == "partial" or menuShow == "false" %}
            .navbar-collapse {
                padding-right: 0 !important;
                padding-left: 0 !important;
            }
            #folder-selection{
                margin-left: 0px !important;
                position: absolute !important;
                left: 0px;
                top: -1px;
                overflow: hidden;
            }
            {% else %}
                #page-wrapper{
                    padding-left: 210px;
                }
            {% endif %}
            video{
                width: 100%;
            }
        </style> 
    </head>
    <body>
    <!-- Navigation -->
    {% if app.request.get('_route') == 'get_files' %}
        {% include 'FACGeneralBundle:Default:feedback.html.twig' %}
    {% endif %}
    {% if files is not defined %}
        {% set files = {} %}
    {% endif %}
    {% if menuShow is defined and menuShow == 'partial' or menuShow is defined and menuShow == 'true' %}
    	{{ render(controller('FACGeneralBundle:Default:navbar', {'route':  app.request.get('_route'), 'files' : files })) }}
    {% endif %}
            <div id="page-wrapper">
                <div class="container-fluid">
                    {% if message is defined %}
                        <div class="alert alert-{{ message.type }}" role="alert">{{ message.text }}</div>
                    {% endif %}
                    <!-- Page Heading -->
                    <div class="row">
                        <div class="col-lg-12">
                            {% if h1 is defined %}
                            <h1 class="page-header">
                                {{ h1 }}
                            </h1>
                            {% endif %}
                            {% if breadcrumb is defined %}
                            <ol class="breadcrumb">
                                <li class="active">
                                    {{ breadcrumb }}
                                </li>
                            </ol>
                            {% endif %}
                        </div>
                    </div>
                    {% block body %}{% endblock %}
                    {% block fos_user_content %}
                    {% endblock fos_user_content %}
                </div>
                <!-- /.container-fluid -->
            </div>
        {% if page is defined %}
            {% if page == "files" or page == "show" %}
                </div>
            {% endif %}
        {% endif %}
         <script>
            var url = document.location.href.split('/');
            if(url[3] == 'files')
                var base_url = url[0]+'/'+url[1]+'/'+url[2];
            else
                var base_url = url[0]+'/'+url[1]+'/'+url[2]+'/'+url[3];

            $(document).ready(function(){
                $('#filesManager').on('mouseenter mouseleave', '.thumbnail:not(.overlay-action), .fancybox-inner:not(.overlay-action)', function(event) {
                    if(!$(event.toElement).attr('target'))
                        $(this).next('.overlay-action').toggle( event.type === 'mouseenter' );  
                });
                $('#filesManager').delegate('.fancy:not(.overlay-action)', 'click', function(evt){
                    var that = this;
                    var attr = $(this).attr('data-fancybox-group');
                    if (typeof attr !== typeof undefined && attr !== false && attr == "gallery") {
                        $('.fancy').fancybox({
                            minWidth: 300,
                            aspectRatio: true,
                            type: 'image',
                            prevEffect : 'none',
                            nextEffect : 'none',
                            preload : 10,
                            closeBtn  : true,
                            arrows    : true,
                            nextClick : true,
                            autoPlay : true,
                            playSpeed : 6000,
                            helpers : {
                                thumbs  : {
                                    width   : 50,
                                    height  : 50
                                } 
                            },
                            afterShow: function() { 
                                $('<div class="overlay-action" style="display:block;"><a target="_blank" href="'+$(that).attr('data-url')+'" data-tooltip="tooltip" title="Télécharger" type="button" class="btn btn-default" data-title="Télécharger">\
                                    <span class="glyphicon glyphicon-download" aria-hidden="true"></span>\
                                </a></div>').appendTo(this.inner).click(function() {
                                    //$(document).toggleFullScreen();
                                });
                            }
                            /*
                            ,
                            afterLoad  : function () {
                                $.extend(this, {
                                    aspectRatio : true,
                                    type    : 'html',
                                    width   : '100%',
                                    height  : '100%',
                                    content : '<div class="fancybox-image" style="background-image:url(' + this.href + '); background-size: cover; background-position:50% 50%;background-repeat:no-repeat;height:100%;width:100%;" /></div>'
                                });
                            }
                            */
                        });
                    }else{
                         $('.fancy').fancybox({
                            minWidth: 300,
                            autoSize : false,
                            aspectRatio: false,
                            type: 'html',
                            prevEffect : 'none',
                            nextEffect : 'none',
                            preload : 10,
                            width   : 445,
                            height  : 280,
                            scrolling : 'visible',
                            closeBtn  : true,
                            arrows    : true,
                            nextClick : true,
                            content : $(this).html(),
                            beforeClose : function(){
                                var videoElement = $('.fancybox-inner #'+$(that).attr('vid-id')).get(0);
                                videoElement.pause();
                                videoElement.src =""; // empty source
                                videoElement.load();
                                $('.fancybox-inner #'+$(that).attr('vid-id')).remove();
                            },
                            afterShow: function() {
                                $('<div class="overlay-action" style="display:block;"><a target="_blank" href="'+$(that).attr('data-url')+'" data-tooltip="tooltip" title="Télécharger" type="button" class="btn btn-default" data-title="Télécharger">\
                                    <span class="glyphicon glyphicon-download" aria-hidden="true"></span>\
                                </a></div>').appendTo(this.inner).click(function() {
                                    //$(document).toggleFullScreen();
                                });
                            }
                        }); 
                    }
                    evt.preventDefault();
                });
                $('body').tooltip({
                    selector: '[data-tooltip=tooltip]',
                    placement: 'bottom',
                    html: true
                });
                $('button[data-toggle=popover]').click(function () {
                    if (!$(this).hasClass('active')) {
                        $('button[data-toggle=popover]').removeClass('active');
                        $('button[data-toggle=popover]').popover('hide');
                        $(this).addClass('active');
                    } else {
                        $('button[data-toggle=popover]').removeClass('active');
                    }
                });
                $('button[data-toggle=popover]').popover({
                    placement: 'bottom',
                    html: true,
                    title: function () {
                        return '<span class="text-info"><strong>' + $(this).attr("data-title") + '</strong></span><button type="button" id="close" class="close" onclick="$(\'button[data-toggle=popover]\').popover(\'hide\');">&times;</button>';
                    },
                    content: function () {
                        return $('#' + $(this).attr('data-conteneur')).html();
                    }
                });
                $('#page-wrapper').css('min-height', $(window).height()-60);
            });
            $(window).on('resize', function(){
                var win = $(this); //this = window
                if (win.height() >= 820) { 
                }
                if (win.width() >= 1280) { 
                }
                $('#page-wrapper').css('min-height', win.height()-60);
            });
        </script>
        <script src="{{ asset('bundles/facgeneral/js/ajax.js') }}" type="text/javascript"></script>
    </body>
</html>