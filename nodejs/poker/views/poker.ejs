<% layout('layout') -%>
<% script() -%>
<% stylesheet() -%>
<div class="row">
    <div class="col-lg-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-long-arrow-right fa-fw"></i> take seat </h3>
            </div>
            <div class="panel-body">
                <div id="table">
                    <div id="place1" class='place place-top'>
                        <div class="userInfo"></div>
                    </div>
                    <div id="place2" class='place place-top'>
                        <div class="userInfo"></div>
                    </div>
                    <div id="place3" class='place place-top'>
                        <div class="userInfo"></div>
                    </div>
                    <canvas id='myCanvas'></canvas>
                    <div id="place4" class='place place-bot'>
                        <div class="userInfo"></div>
                    </div>
                    <div id="place5" class='place place-bot'>
                        <div class="userInfo"></div>
                    </div>
                    <div id="place6" class='place place-bot'>
                        <div class="userInfo"></div>
                    </div>
                </div>
                <div class="text-right">
                    <a href="#">Externalize table <i class="fa fa-arrow-circle-right"></i></a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
    <div class="panel panel-default">
        <div class="panel-heading">
            <i class="fa fa-user"></i>
            <%= user.username %>
        </div>
        <!-- /.panel-heading -->
        <div class="panel-body">
            <p>votre argent : <span id="ownMoney"></span></p>
            <p>votre mise :</p>
            <p>vos cartes :</p>
        </div>
    </div>
    <!-- /.panel-footer -->
</div>
    <% include chat %>
</div>
<!-- /.row -->

<script src="/socket.io/socket.io.js"></script>
<script>
    var canvas = document.getElementById('myCanvas');
    var ctx = canvas.getContext('2d');
    var img = new Image();
    img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0, img.width, img.height);
    }
    img.src = '/img/table.jpg';
    canvas.addEventListener("mousemove", doMouseOver, false);
    function doMouseOver(event) {
        if (event.pageY >= 478 && event.pageY <= 480) {
            console.log('coin gauche');
        }
        //console.log(event.pageY, event.pageX);
        }
        <% 
        var active = 0;
        if (poker && poker.user){
            for(var i=0; i<poker.user.length; i++){
                if (poker.user[i].place){
                   if(poker.user[i].username == user.username){
                       var active = 1;
                       %>
                       $('#ownMoney').html('<%= poker.user[i].money %>');
               <%
                   }
                %>
                $('#<%= poker.user[i].place %>').addClass('active');
                $('#<%= poker.user[i].place %> .userInfo').html('<p><%= poker.user[i].username %></p><p><%= poker.user[i].money %></p>');
        <%      }
            }
        }
        
        if(!active){ %>
            //place action
            $('.place').mouseover(function () {
                $('.place').removeClass('active');
                $(this).addClass('active');
            });
            $('.place').click(function () {
                socket.emit('new_poker_user', '<%= user.username %>', '<%=req.params.num %>', $(this).attr('id'));
                insereMessage('Admin', 'Salut, <%= user.username %>, vous pouvez chater en jouant :)');
                $(this).addClass('active');
            });
    <% } %>
    // Quand un nouveau client se connecte, on affiche l'information
    socket.on('new_poker_user', function (pseudo, place) {
        $('#' + place).addClass('active');
        $('.table').prepend('<p><em>' + pseudo + ' a rejoint la table !</em></p>');
    })
</script>